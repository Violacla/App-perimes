<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Gestion Perim√© - Pharmacie du Libron</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: #f9f9f9;
    }
    /* Bandeau bleu en haut */
    header {
      background: #bcd7ed;
      color: #0b2e59;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    header .left,
    header .right {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    header h1 {
      font-size: 18px;
      font-weight: 700;
      margin: 0;
      user-select: none;
    }
    button, select {
      background: white;
      border: 1px solid #0b2e59;
      color: #0b2e59;
      border-radius: 3px;
      padding: 5px 10px;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }
    button:hover, select:hover {
      background: #99c1e8;
      color: #fff;
      border-color: #074070;
    }
    button svg {
      width: 16px;
      height: 16px;
      fill: #0b2e59;
    }
    button:hover svg {
      fill: #fff;
    }
    /* Tableau principal */
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
      background: white;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
      font-size: 14px;
    }
    tbody tr:nth-child(even) {
      background-color: rgba(188, 215, 237, 0.15); /* #bcd7ed opacity 15% */
    }
    tbody tr.selected {
      background-color: rgba(188, 215, 237, 0.5); /* #bcd7ed opacity 50% */
    }
    td.editable {
      cursor: text;
      background: #f0f8ff;
    }
    td.editable:focus {
      outline: 2px solid #0b2e59;
      background: #e0f0ff;
    }
    /* Popup Notification */
    #notification-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border: 2px solid #0b2e59;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      width: 600px;
      max-height: 70vh;
      overflow-y: auto;
      display: none;
      flex-direction: column;
      border-radius: 8px;
      z-index: 1500;
      padding: 10px;
    }
    #notification-popup .header {
      background: #0b2e59;
      color: white;
      padding: 10px;
      font-weight: bold;
      font-size: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-top-left-radius: 6px;
      border-top-right-radius: 6px;
    }
    #notification-popup .header button.close-popup {
      background: transparent;
      border: none;
      font-size: 20px;
      color: white;
      cursor: pointer;
      line-height: 1;
    }
    #notification-popup .content {
      padding: 10px;
      font-size: 14px;
      color: #0b2e59;
    }
    #notification-popup table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
    }
    #notification-popup th, #notification-popup td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: left;
      font-size: 13px;
    }
    #notification-popup tbody tr:nth-child(even) {
      background-color: rgba(188, 215, 237, 0.15);
    }
    #notification-popup .month-section {
      margin-bottom: 20px;
    }
    /* Imprimer uniquement le popup */
    @media print {
      body * {
        visibility: hidden;
      }
      #notification-popup, #notification-popup * {
        visibility: visible;
      }
      #notification-popup {
        position: static;
        transform: none;
        width: 100%;
        max-height: none;
        box-shadow: none;
        border: none;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="left">
      <button id="btn-home" title="Retour √† l'accueil" aria-label="Retour √† l'accueil">
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" style="width:22px;height:22px;fill:#0b2e59;">
          <path d="M32 12l20 20h-6v20h-28v-20h-6z" stroke="#0b2e59" stroke-width="2" fill="none" />
          <path d="M26 32v12h12v-12" fill="#0b2e59"/>
        </svg>
      </button>
      <h1>Gestion Perim√© - Pharmacie du Libron</h1>
      <select id="operator" title="Choisir un op√©rateur" aria-label="Choisir un op√©rateur">
        <option value="">-- Choisir Op√©rateur --</option>
        <option>Op1</option>
        <option>Op2</option>
        <option>Op3</option>
        <option>Op4</option>
      </select>
      <button id="btn-confirm-operator" title="Valider op√©rateur">Valider</button>
    </div>
    <div class="right">
      <button id="btn-notification" title="Notifications">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false" style="width:16px;height:16px;fill:#0b2e59;">
          <path d="M12 22c1.1 0 2-.89 2-1.99h-4c0 1.1.9 1.99 2 1.99zM18 16v-5c0-3.07-1.63-5.64-4.5-6.32V4a1.5 1.5 0 0 0-3 0v.68C7.63 5.36 6 7.92 6 11v5l-1.99 2H20l-2-2z"/>
        </svg>
        Notifications
      </button>
      <button id="btn-history" title="Historique">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false" style="width:16px;height:16px;fill:#0b2e59;">
          <path d="M13 3a9 9 0 1 0 9 9h-2a7 7 0 1 1-7-7v3l4-4-4-4v3z"/>
        </svg>
        Historique
      </button>
      <button id="btn-logout" title="D√©connexion">D√©connexion</button>
    </div>
  </header>

  <main style="padding:15px; max-width: 900px; margin: auto;">
    <table id="product-table" aria-label="Tableau des produits p√©rim√©s">
      <thead>
        <tr>
          <th>Date</th>
          <th>Bo√Æte</th>
          <th>Nb Bo√Ætes</th>
          <th>Zone</th>
          <th>Nb vendus</th>
          <th>Nb promo</th>
        </tr>
      </thead>
      <tbody>
        <!-- Lignes g√©n√©r√©es par JS -->
      </tbody>
    </table>
  </main>

  <div id="notification-popup" role="dialog" aria-modal="true" aria-labelledby="notif-title" aria-describedby="notif-desc">
    <div class="header">
      <span id="notif-title">Notifications des p√©rim√©s (3 mois)</span>
      <div>
        <button id="btn-print" title="Imprimer" aria-label="Imprimer la liste des notifications" style="margin-right:8px;">
          üñ®Ô∏è Imprimer
        </button>
        <button class="close-popup" aria-label="Fermer la fen√™tre">&times;</button>
      </div>
    </div>
    <div class="content" id="notif-desc">
      <!-- Contenu dynamique -->
    </div>
  </div>

<script>
  // donn√©es exemples (remplacer par la vraie source)
  const products = [
    {date: '2025-06-10', product: 'Paracetamol', qty: 100, zone: 'A', sold: 50, promo: 10},
    {date: '2025-06-15', product: 'Ibuprofen', qty: 200, zone: 'B', sold: 75, promo: 20},
    {date: '2025-07-05', product: 'Aspirine', qty: 150, zone: 'A', sold: 60, promo: 15},
    {date: '2025-07-20', product: 'Doliprane', qty: 100, zone: 'C', sold: 40, promo: 5},
    {date: '2025-08-10', product: 'Amoxicilline', qty: 300, zone: 'B', sold: 150, promo: 30},
    {date: '2025-08-25', product: 'Voltaren', qty: 80, zone: 'A', sold: 35, promo: 7}
  ];

  const tableBody = document.querySelector("#product-table tbody");

  function renderTable(data) {
    tableBody.innerHTML = '';
    data.forEach((p, idx) => {
      const tr = document.createElement('tr');
      tr.tabIndex = 0;
      if(idx % 2 === 1) tr.style.backgroundColor = 'rgba(188, 215, 237, 0.15)';
      tr.addEventListener('click', () => {
        [...tableBody.querySelectorAll('tr')].forEach(r => r.classList.remove('selected'));
        tr.classList.add('selected');
      });
      tr.innerHTML = `
        <td>${p.date}</td>
        <td contenteditable="true" class="editable">${p.product}</td>
        <td contenteditable="true" class="editable">${p.qty}</td>
        <td contenteditable="true" class="editable">${p.zone}</td>
        <td contenteditable="true" class="editable">${p.sold}</td>
        <td contenteditable="true" class="editable">${p.promo}</td>
      `;
      tr.querySelectorAll('.editable').forEach((td, i) => {
        td.addEventListener('blur', () => {
          let val = td.innerText.trim();
          switch(i) {
            case 1: p.product = val; break;
            case 2: p.qty = parseInt(val) || 0; td.innerText = p.qty; break;
            case 3: p.zone = val; break;
            case 4: p.sold = parseInt(val) || 0; td.innerText = p.sold; break;
            case 5: p.promo = parseInt(val) || 0; td.innerText = p.promo; break;
          }
        });
      });
      tableBody.appendChild(tr);
    });
  }

  renderTable(products);

  // Notification popup
  const btnNotif = document.getElementById('btn-notification');
  const notifPopup = document.getElementById('notification-popup');
  const notifContent = notifPopup.querySelector('.content');
  const closePopupBtn = notifPopup.querySelector('.close-popup');
  const btnPrint = document.getElementById('btn-print');

  btnNotif.addEventListener('click', () => {
    notifContent.innerHTML = ''; 

    // Calcul des 3 mois √† afficher √† partir du 15 du mois courant
    const today = new Date();
    const year = today.getFullYear();
    let month = today.getMonth();

    if(today.getDate() >= 15) month++;

    // On r√©cup√®re 3 mois complets
    const monthsToShow = [];
    for(let i=0; i<3; i++) {
      monthsToShow.push(new Date(year, month + i, 1));
    }

    // Construction HTML pour chaque mois
    monthsToShow.forEach(m => {
      const monthNum = m.getMonth();
      const yearNum = m.getFullYear();

      // Filtrer les produits pour ce mois/ann√©e
      const filtered = products.filter(p => {
        const d = new Date(p.date);
        return d.getMonth() === monthNum && d.getFullYear() === yearNum;
      });

      // Section mois
      const monthSection = document.createElement('div');
      monthSection.className = 'month-section';

      const title = document.createElement('h4');
      title.textContent = m.toLocaleString('fr-FR', {month:'long', year:'numeric'});
      monthSection.appendChild(title);

      if(filtered.length === 0) {
        const p = document.createElement('p');
        p.textContent = 'Aucun produit p√©rim√©';
        monthSection.appendChild(p);
      } else {
        // Cr√©ation tableau
        const table = document.createElement('table');
        const thead = document.createElement('thead');
        thead.innerHTML = `<tr>
          <th>Date</th><th>Bo√Æte</th><th>Nb Bo√Ætes</th><th>Zone</th><th>Nb vendus</th><th>Nb promo</th>
        </tr>`;
        table.appendChild(thead);

        const tbody = document.createElement('tbody');
        filtered.forEach(p => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${p.date}</td>
            <td>${p.product}</td>
            <td>${p.qty}</td>
            <td>${p.zone}</td>
            <td>${p.sold}</td>
            <td>${p.promo}</td>
          `;
          tbody.appendChild(tr);
        });
        table.appendChild(tbody);
        monthSection.appendChild(table);
      }
      notifContent.appendChild(monthSection);
    });

    notifPopup.style.display = 'flex';
  });

  closePopupBtn.addEventListener('click', () => {
    notifPopup.style.display = 'none';
  });

  btnPrint.addEventListener('click', () => {
    window.print();
  });

  // Retour accueil
  document.getElementById('btn-home').addEventListener('click', () => {
    window.location.reload();
  });

  // D√©connexion simple
  document.getElementById('btn-logout').addEventListener('click', () => {
    alert('D√©connexion effectu√©e');
  });

  // Historique (√† compl√©ter)
  document.getElementById('btn-history').addEventListener('click', () => {
    alert('Historique √† d√©velopper');
  });
</script>
</body>
</html>
